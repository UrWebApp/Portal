<main class="container postWrap">
  <article class="postArticle">
    <div class="postArticleHeader">
      <h1 class="pt-1">.NET 6 輕量視覺化 Log 工具 WatchDog</h1>
      <div class="infoBox">
        <i class="fa fa-eye" aria-hidden="true"></i>
        <p class="waline-pageview-count" data-path="/Dev-Tech/NET6LogToolWatchDog/" />
        </p>
        <span>|</span>
        <p>2023/01/08</p>
        <span>|</span>
        <p>
          
            <a href="/categories/Dev-Tech/ ">Dev Tech </a>
            
        </p>
        <span>|</span>
        <ul class="tagBox">
          
            <li>
              <a href="/tags/Net/">
                <!-- <i class="fa-solid fa-tag"></i>  -->
                <div class="tagIcon"></div>
                .Net
              </a>
            </li>
            
            <li>
              <a href="/tags/Log/">
                <!-- <i class="fa-solid fa-tag"></i>  -->
                <div class="tagIcon"></div>
                Log
              </a>
            </li>
            
        </ul>
      </div>
    </div>
    <div class="postArticleContent">
      <div class="authorsWordsBox">
        <p class="title">kai98k</p>
        <p class="content">這個作者很懶，什麼都沒留下...</p>
      </div>
      <p>在專案中，上機測試常常會碰到原本開發上沒遇過的問題，這時候就要環境中留存的 Log 來做 Debug 了。如專案中的 Log 衍生需求不多，建議可使用這套 WatchDog 工具。</p>
<h2 id="介紹"><a href="#介紹" class="headerlink" title="介紹"></a>介紹</h2><p>WatchDog 利用 SignalR 與預設 LiteDb 來實現 Web UI 即時監控 Http&#x2F;Error Log 等事件 ，可依需求替換不同的資料庫，像是MSSQL、MySQl、Postgres。</p>
<h3 id="特點"><a href="#特點" class="headerlink" title="特點"></a>特點</h3><ul>
<li>即時捕獲 Http 請求&#x2F;回應</li>
<li>即時異常例外紀錄</li>
<li>可在程式內客製化 Log 訊息紀錄</li>
<li>友善的 Log 察看頁面</li>
<li>支援 Log 日誌搜尋</li>
<li>可定時自動清除 Log</li>
</ul>
<h2 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h2><p>使用 Nuget 介面安裝，或是使用以下指令</p>
<pre class="line-numbers language-console" data-language="console"><code class="language-console">dotnet add package WatchDog.NET --version 1.3.3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="在-Program-cs-設定"><a href="#在-Program-cs-設定" class="headerlink" title="在 Program.cs 設定"></a>在 Program.cs 設定</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">&#x2F;&#x2F; Program.cs

using WatchDog;

var builder &#x3D; WebApplication.CreateBuilder(args);

builder.Services.AddWatchDogServices(option &#x3D;&gt;
    &#123;
        option.IsAutoClear &#x3D; true;
        option.ClearTimeSchedule &#x3D; WatchDogAutoClearScheduleEnum.Monthly;
        &#x2F;&#x2F; 以下可不填
        option.SqlDriverOption &#x3D; WatchDogSqlDriverEnum.MSSQL;
        option.SetExternalDbConnString &#x3D; &quot;Data Source&#x3D;localhost;Initial Catalog&#x3D;WatchDog;Integrated Security&#x3D;True&quot;;

    &#125;);

var app &#x3D; builder.Build();

app.UseWatchDogExceptionLogger();
    app.UseWatchDog(option &#x3D;&gt;
    &#123;
        option.WatchPageUsername &#x3D; &quot;Username&quot;;
        option.WatchPagePassword &#x3D; &quot;P@ssword&quot;;
          &#x2F;&#x2F; 以下可不填
        option.Blacklist &#x3D; &quot;Test&#x2F;testPost, weatherforecast&quot;; &#x2F;&#x2F;Prevent logging for specified endpoints
        option.Serializer &#x3D; WatchDogSerializerEnum.Newtonsoft; &#x2F;&#x2F;If your project use a global json converter
        option.CorsPolicy &#x3D; &quot;MyCorsPolicy&quot;

    &#125;);

app.UseAuthorization();
app.Run();<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li><code>IsAutoClear</code>:設定 Log 自動清除。</li>
<li><code>ClearTimeSchedule</code>: 設定自動清除計畫，上者要是 <code>true</code>。</li>
<li><code>SqlDriverOption</code>: 可不填，不填時自動預設 liteDB 為資料庫，在範例中使用 MSSQL。</li>
<li><code>SetExternalDbConnstring</code>: 為資料庫連線字串</li>
<li><code>WatchPageUsername</code>: 為可視化頁面登入帳號。</li>
<li><code>watchPagePassword</code>: 為可視化頁面登入密碼。</li>
</ul>
<h2 id="Log-訊息-事件"><a href="#Log-訊息-事件" class="headerlink" title="Log 訊息&#x2F;事件"></a>Log 訊息&#x2F;事件</h2><pre class="line-numbers language-c#" data-language="c#"><code class="language-c#">&#x2F;&#x2F; Program.cs
WatchLogger.Log(&quot;...TestGet Started...&quot;);
WatchLogger.LogWarning(JsonConvert.Serialize(model));
WatchLogger.LogError(res.Content);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>事件層級為普通<code>Log</code>、<code>LogWarning</code>、<code>LogError</code>，可自訂義 log 訊息。</p>
<h2 id="測試"><a href="#測試" class="headerlink" title="測試"></a>測試</h2><p>專案啟動後，可在根目錄輸入 &#x2F;watchdog，可至可視化頁面，登入帳密在剛剛的設定中，登入後可以看到剛剛下的 Log。<br><img src="./assets/img/download.png" data-original="https://i.imgur.com/QuZHHMa.png" alt="watchdog"><br><img src="./assets/img/download.png" data-original="https://github.com/IzyPro/WatchDog/raw/main/watchlog.png" alt="watchdog"></p>
<h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>在專案後期如果要增加需求時，以下劣勢就出現了，所以還是要自行評估是否引入。</p>
<ul>
<li>無法寫成 txt 檔</li>
<li>無法在事件發生時寄信給相關人士</li>
<li>只支援 .Net core 3.2+</li>
</ul>
<p>撇除這三點，其實還算是不錯的，且原始 source code 也算明瞭，可以 clone&#x2F;fork 下來魔改。<br>例如: <a target="_blank" rel="noopener" href="https://github.com/IzyPro/WatchDog/pull/91/files">結合 Mailkit 在 Log 時，寄信給相關人士</a></p>
<h2 id="參考資料"><a href="#參考資料" class="headerlink" title="參考資料"></a>參考資料</h2><p><a target="_blank" rel="noopener" href="https://github.com/IzyPro/WatchDog/pull/91/files">WatchDog</a></p>

    </div>
  </article>
  <div class="postNext d-flex justify-content-between mt-3 mb-3">
    
      <h4>
        <a href="/Dev-Tech/LetYouRoughlyKnowHttpRequest/">
          <span><<</span>
          <!-- <i class="fa-solid fa-angles-left"></i>  -->
          讓你大概搞懂 Http Request
        </a>
      </h4>
      
        
          <h4>
            <a href="/Dev-Tech/UseSerilogToSendMail/">
              .NET6 使用 Serilog，在 log 當下同時寄信 
              <span>>></span>
              <!-- <i class="fa-solid fa-angles-right"></i> -->
            </a>
          </h4>
          
  </div>
  
  <div id="waline"></div>
  <script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
    let option = '{"el":"#waline","enable":true,"serverURL":"https://waline-urweb.vercel.app/","placeholder":"歡迎隨時提出您的建議，並不吝指教","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":"en","visitor":true,"comment_count":true,"requiredFields":["nick","mail"],"libUrl":"https://cdnjs.cloudflare.com/ajax/libs/waline/2.14.5/waline.js","pageview":true,"reaction":true}';
    init(JSON.parse(option));
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>
  
    <input style="display:none" onload="addTotalViews()">
</main>