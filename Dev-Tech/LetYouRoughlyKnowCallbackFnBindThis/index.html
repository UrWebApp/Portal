<main class="container postWrap">
  <article class="postArticle">
    <div class="postArticleHeader">
      <h1 class="pt-1">讓你大概搞懂 CallbackFn & Bind(this)</h1>
      <div class="infoBox">
        <i class="fa fa-eye" aria-hidden="true"></i>
        <p class="waline-pageview-count" data-path="/Dev-Tech/LetYouRoughlyKnowCallbackFnBindThis/" />
        </p>
        <span>|</span>
        <p>2023/06/03</p>
        <span>|</span>
        <p>
          
            <a href="/categories/Dev-Tech/ ">Dev Tech </a>
            
        </p>
        <span>|</span>
        <ul class="tagBox">
          
            <li>
              <a href="/tags/JavaScript/">
                <!-- <i class="fa-solid fa-tag"></i>  -->
                <div class="tagIcon"></div>
                JavaScript
              </a>
            </li>
            
            <li>
              <a href="/tags/Angular/">
                <!-- <i class="fa-solid fa-tag"></i>  -->
                <div class="tagIcon"></div>
                Angular
              </a>
            </li>
            
        </ul>
      </div>
    </div>
    <div class="postArticleContent">
      <div class="authorsWordsBox">
        <p class="title">johch3n611u</p>
        <p class="content">前端除了動畫以外真的還有好多可以深入的地方...</p>
      </div>
      <p>最近遇到一個外部引入的 script 需要整合進 Angular 中，CallbackFn 與 this 拆開來能理解，在 Angular 中元件中的 this 通常指向當前元件實例。</p>
<p>而進到 CallbackFn 後 this 亂了，曾經嘗試過箭頭函式也是失敗，最後用一個智障方法，先保存在 localstage 在取出來用，還好是同事幫忙 Code Review 用了 Bind 這個原生方法，才發現難的是。</p>
<p>首先跟 Sage AI 要了一些 CallFn Exceport 發現，挺單純挺好懂得</p>
<h2 id="Sage-CallFunction-Exceport"><a href="#Sage-CallFunction-Exceport" class="headerlink" title="Sage CallFunction Exceport"></a>Sage CallFunction Exceport</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 模拟异步操作</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">displayData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>data<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">, Age: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>data<span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//////////////////////</span>

<span class="token keyword">function</span> <span class="token function">sortArray</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> compareFunc</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>compareFunc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">compareFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token keyword">const</span> sortedNumbers <span class="token operator">=</span> <span class="token function">sortArray</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> compareFunc<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sortedNumbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 [1, 1, 3, 4, 5, 9]</span>

<span class="token comment">///////////////////////</span>

<span class="token keyword">function</span> <span class="token function">filterArray</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> filterFunc</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>filterFunc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">filterFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token operator">=></span> num <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> filteredNumbers <span class="token operator">=</span> <span class="token function">filterArray</span><span class="token punctuation">(</span>numbers<span class="token punctuation">,</span> filterFunc<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>filteredNumbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 [4]</span>

<span class="token comment">//////////////////////</span>

<span class="token keyword">function</span> <span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> eventName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#myButton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Button clicked'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">addEventListener</span><span class="token punctuation">(</span>button<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> handleClick<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Sage-CallFunction-this-Exceport"><a href="#Sage-CallFunction-this-Exceport" class="headerlink" title="Sage CallFunction &amp;&amp; this Exceport"></a>Sage CallFunction &amp;&amp; this Exceport</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> myObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sayHello</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, my name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> and I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> years old.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">logMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The "sayHello" method has finished executing.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

myObj<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>logMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Hello, my name is John and I am 30 years old.</span>
<span class="token comment">// The "sayHello" method has finished executing.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Sage-CallFunction-this-Bind-this-Exceport"><a href="#Sage-CallFunction-this-Bind-this-Exceport" class="headerlink" title="Sage CallFunction &amp;&amp; this &amp;&amp; Bind(this) Exceport"></a>Sage CallFunction &amp;&amp; this &amp;&amp; Bind(this) Exceport</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> myObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sayHello</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, my name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> and I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> years old.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> sayHelloFunc <span class="token operator">=</span> myObj<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>myObj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sayHelloFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 "Hello, my name is John and I am 30 years old."</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Angular-Component-Mixd-ChatScript"><a href="#Angular-Component-Mixd-ChatScript" class="headerlink" title="Angular Component Mixd ChatScript"></a>Angular Component Mixd ChatScript</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">
<span class="token function">constructor</span><span class="token punctuation">(</span>
  <span class="token parameter">@<span class="token function">Inject</span><span class="token punctuation">(</span><span class="token constant">DOCUMENT</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token literal-property property">document</span><span class="token operator">:</span> Document<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>document<span class="token punctuation">,</span> <span class="token string">"Freshchat-js-sdk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">initialize</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// let w: any = window;</span>
  <span class="token comment">// let freshChatConfig = JSON.parse(localStorage.getItem('freshChatConfig'));</span>
  <span class="token comment">// if(!w.fcWidget)&#123;</span>
  <span class="token comment">//     let e; i.getElementById(t) ?</span>
  <span class="token comment">//     this.initFreshChat() : (</span>
  <span class="token comment">//       (e = i.createElement("script")).id = t,</span>
  <span class="token comment">//       e.async = !0,</span>
  <span class="token comment">//       e.src = `$&#123;freshChatConfig.url&#125;/js/widget.js`,</span>
  <span class="token comment">//       e.onload = this.initFreshChat,</span>
  <span class="token comment">//       i.head.appendChild(e)</span>
  <span class="token comment">//     );</span>
  <span class="token keyword">let</span> e<span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initFreshChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span>e <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id <span class="token operator">=</span> t<span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"https://watsons4.freshchat.com/js/widget.js"</span><span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initFreshChat</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    i<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  window<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unreadCountNotify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>freshChatService<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">initFreshChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// let freshChatConfig = JSON.parse(localStorage.getItem('freshChatConfig'));</span>
  <span class="token keyword">let</span> <span class="token literal-property property">w</span><span class="token operator">:</span> any <span class="token operator">=</span> window<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>w<span class="token punctuation">.</span>fcWidget<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    w<span class="token punctuation">.</span>fcWidget<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token comment">// token: freshChatConfig.token,</span>
      <span class="token comment">// host: freshChatConfig.url,</span>
      <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>freshChatToken<span class="token punctuation">,</span>
      <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>freshChatUrl<span class="token punctuation">,</span>
      <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">headerProperty</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">appName</span><span class="token operator">:</span> <span class="token string">'freshChat'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">hideChatButton</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>document<span class="token punctuation">,</span> <span class="token string">"Freshchat-js-sdk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> e<span class="token punctuation">;</span> 
        i<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">?</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initFreshChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> 
        <span class="token punctuation">(</span>
          <span class="token punctuation">(</span>e <span class="token operator">=</span> i<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id <span class="token operator">=</span> t<span class="token punctuation">,</span>
          e<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
          e<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>freshChatConfig<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/js/widget.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          e<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>initFreshChat<span class="token punctuation">,</span> <span class="token comment">// callback fn</span>
          i<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 這個函數使用 getElementById 方法檢查是否存在 t 標識的元素。如果存在，則調用 initFreshChat 函数；否則，它會創建一個新的 script 元素，設置其 id、async 屬性和 src 屬性為指定的 URL，並將其添加到 head 元素中。當這個 script 元素完成加載時，它會調用 initFreshChat 函数。</span>

<span class="token keyword">function</span> <span class="token function">initFreshChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token literal-property property">w</span><span class="token operator">:</span> any <span class="token operator">=</span> window<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>w<span class="token punctuation">.</span>fcWidget<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      w<span class="token punctuation">.</span>fcWidget<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">token</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">headerProperty</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">appName</span><span class="token operator">:</span> <span class="token string">'freshChat'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">hideChatButton</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 將 window 對象賦值給變量 w。然後，它檢查 w.fcWidget 是否存在。如果存在，它會調用 fcWidget.init 方法，並傳遞一個包含 token、host 和 config 屬性的對象。在此示例中，config 對象包含一個名為 headerProperty 的屬性，該屬性又包含兩個屬性：appName 和 hideChatButton，分別設置為 'freshChat' 和 true。這些屬性用於配置 Freshchat widget 的外觀和行為。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在這段代碼中，initFreshChat 函數是作為回調函數（callback function）傳遞給 onload 屬性的，當該 script 元素加載完成時，就會調用 initFreshChat 函數。在這種情況下，initFreshChat 函數中的 this 會指向 window 對象，因為它是在全局作用域中被調用的。</p>
<p>另一方面，當 initialize 函數中的 getElementById 方法返回 true，並且調用了 initFreshChat 函數時，initFreshChat 函數中的 this 則會指向 fcWidget 對象，因為 initFreshChat 函數是作為 fcWidget 對象的一個方法被調用的。在這種情況下，this 會被繫結到方法被調用的對象上，即 fcWidget 對象。</p>
<p><a href="how-to-access-the-correct-this-inside-a-callback">https://stackoverflow.com/questions/20279484/how-to-access-the-correct-this-inside-a-callback</a></p>
<h2 id="箭頭函式-this"><a href="#箭頭函式-this" class="headerlink" title="箭頭函式 &amp; this"></a>箭頭函式 &amp; this</h2><p><a target="_blank" rel="noopener" href="https://pjchender.dev/javascript/js-arrow-function/">箭頭函式（arrow function）和它對 this 的影響</a></p>
<p>todo 找時間補</p>

    </div>
  </article>
  <div class="postNext d-flex justify-content-between mt-3 mb-3">
    
      <h4>
        <a href="/Dev-Tech/LetYouRoughlyKnowQueue/">
          <span><<</span>
          <!-- <i class="fa-solid fa-angles-left"></i>  -->
          讓你大概搞懂 Queue
        </a>
      </h4>
      
        
          <h4>
            <a href="/Dev-Tech/DifferenceBetweenSSHnSSL/">
              SSH 比 SSL 更安全嗎? 
              <span>>></span>
              <!-- <i class="fa-solid fa-angles-right"></i> -->
            </a>
          </h4>
          
  </div>
  
  <div id="waline"></div>
  <script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
    let option = '{"el":"#waline","enable":true,"serverURL":"https://waline-urweb.vercel.app/","placeholder":"歡迎隨時提出您的建議，並不吝指教","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":"en","visitor":true,"comment_count":true,"requiredFields":["nick","mail"],"libUrl":"https://cdnjs.cloudflare.com/ajax/libs/waline/2.14.5/waline.js","pageview":true,"reaction":true}';
    init(JSON.parse(option));
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>
  
    <input style="display:none" onload="addTotalViews()">
</main>