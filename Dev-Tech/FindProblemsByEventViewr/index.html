<main class="container postWrap">
  <article class="postArticle">
    <div class="postArticleHeader">
      <h1 class="pt-1">查找 IIS 站台相關問題與重啟 Application Pool 機制</h1>
      <div class="infoBox">
        <i class="fa fa-eye" aria-hidden="true"></i>
        <p class="waline-pageview-count" data-path="/Dev-Tech/FindProblemsByEventViewr/" />
        </p>
        <span>|</span>
        <p>2023/05/01</p>
        <span>|</span>
        <p>
          
            <a href="/categories/Dev-Tech/ ">Dev Tech </a>
            
        </p>
        <span>|</span>
        <ul class="tagBox">
          
            <li>
              <a href="/tags/IIS/">
                <!-- <i class="fa-solid fa-tag"></i>  -->
                <div class="tagIcon"></div>
                IIS
              </a>
            </li>
            
        </ul>
      </div>
    </div>
    <div class="postArticleContent">
      <div class="authorsWordsBox">
        <p class="title">kai98k</p>
        <p class="content">這個作者很懶，什麼都沒留下...</p>
      </div>
      <p>許多人可能知道怎麼在 IIS 架設網站，卻不知道相關的伺服器 Log 要在哪尋找，答案就是事件檢視器(event viewer)。</p>
<p><img src="./assets/img/download.png" data-original="https://i.imgur.com/ghSzGGS.png" alt="事件檢視器"></p>
<h2 id="Event-Viewer"><a href="#Event-Viewer" class="headerlink" title="Event Viewer"></a>Event Viewer</h2><p>打開後，可以看到 Web Server 相關事件，以及站台關閉原因等等，有時候當站台剛部屬好時，Runtime 卻出了問題(套件可能需要 .net4.5 CLR application pool，但程式是 .net 6 等等)，這時候 Serilog 等套件也無法觀察到此現象時，就可以到 .NET EventLog 查看站台強制關閉等事件。 </p>
<h2 id="Application-Pool機制"><a href="#Application-Pool機制" class="headerlink" title="Application Pool機制"></a>Application Pool機制</h2><p>而以下圖片顯示的站台關閉事件是 IIS (Internet Information Services) 警告訊息，表示應用程式池 (Application Pool) 內的工作程序 (worker process) 已經因為閒置時間過長而被關閉。</p>
<p><img src="./assets/img/download.png" data-original="https://i.imgur.com/pbo8NBV.png" alt="站台關閉事件"></p>
<p>IIS 預設情況下會將應用程式池的閒置超時時間設置為 20 分鐘。如果工作程序在這段時間內沒有處理任何請求，就會被 IIS 自動關閉，以節省系統資源。</p>
<p>在這種情況下，IIS 會在需要時啟動一個新的工作程序，以便繼續處理新的請求。</p>
<p>如果你不希望應用程式池在閒置一段時間後被關閉，可以在 IIS 中調整應用程式池的閒置超時時間設定，或將其設置為 0，這樣工作程序就不會被自動關閉。</p>
<p>需要注意的是，如果你的應用程式在處理請求時需要較長的時間，例如處理大量資料或執行複雜的演算法，就需要調整應用程式池的配置，以避免在處理請求時被自動關閉。</p>
<p>在 IIS 中調整應用程式池的閒置超時時間設定，或將其設置為 0，可以按照以下步驟進行：</p>
<ol>
<li><p>開啟 IIS 管理員控制台，選擇應用程式池，右鍵點選需要調整的應用程式池，並選擇 “進階設定”。<br><img src="./assets/img/download.png" data-original="https://i.imgur.com/SzmWmlK.png" alt="步驟1"></p>
</li>
<li><p>找到 “進程模型” 區段，滾動到下面的 “閒置時間 (分鐘)” 設定項目。<br><img src="./assets/img/download.png" data-original="https://i.imgur.com/lZKXdao.png" alt="步驟2"></p>
</li>
<li><p>將閒置時間設定為所需的值，或者設定為 0，表示永遠不會自動關閉工作程序。</p>
</li>
<li><p>按下 “確定” 按鈕，保存設定。</p>
</li>
</ol>
<p>設定應用程式池的閒置超時時間後，應用程式池內的工作程序就不會因閒置超時而自動關閉。需要注意的是，設定的閒置時間長度應該根據你的應用程式所需的處理時間來決定，避免閒置時間過短或過長導致工作程序無法正常運作。</p>
<h2 id="Task-Scheduler-工作排程器"><a href="#Task-Scheduler-工作排程器" class="headerlink" title="Task Scheduler 工作排程器"></a>Task Scheduler 工作排程器</h2><p>除了將IIS設定調整以外，也可以在 Windows 內建的工作排程器，利用 Shut down 的 Event ID 成為重啟網頁的 Trigger，因為開啟網頁，也可以讓程式重啟。</p>
<ol>
<li><p>打開工作排程器</p>
</li>
<li><p>點擊 Create Basic Task</p>
</li>
</ol>
<p><img src="./assets/img/download.png" data-original="https://i.imgur.com/4xt36ui.png" alt="步驟2"></p>
<ol start="3">
<li>填寫工作描述</li>
</ol>
<p><img src="./assets/img/download.png" data-original="https://i.imgur.com/cYK8qjt.png" alt="步驟3"></p>
<ol start="4">
<li>選擇 Event Trigger</li>
</ol>
<p><img src="./assets/img/download.png" data-original="https://i.imgur.com/rJcONAr.png" alt="步驟4"></p>
<ol start="5">
<li>選擇 Event</li>
</ol>
<p><img src="./assets/img/download.png" data-original="https://i.imgur.com/14hEStj.png" alt="步驟5"></p>
<ol start="6">
<li>選擇觸發時，需執行的步驟，這邊選擇執行程序</li>
</ol>
<p><img src="./assets/img/download.png" data-original="https://i.imgur.com/cnyGvo7.png" alt="步驟6"></p>
<ol start="7">
<li>選擇要執行的程序，這邊選擇我自己寫的 Bat 檔</li>
</ol>
<p><img src="./assets/img/download.png" data-original="https://i.imgur.com/vzCpuJj.png" alt="步驟7"></p>
<ol start="8">
<li>完成!</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.darkthread.net/blog/iis-app-pool-auto-recycle/">【茶包射手日記】IIS的29小時魔咒</a></li>
</ul>

    </div>
  </article>
  <div class="postNext d-flex justify-content-between mt-3 mb-3">
    
      <h4>
        <a href="/Dev-Tech/DifferenceBetweenSSHnSSL/">
          <span><<</span>
          <!-- <i class="fa-solid fa-angles-left"></i>  -->
          SSH 比 SSL 更安全嗎?
        </a>
      </h4>
      
        
          <h4>
            <a href="/Dev-Tech/TalkAboutAuthorization/">
              你是誰?淺談身分認證方式 
              <span>>></span>
              <!-- <i class="fa-solid fa-angles-right"></i> -->
            </a>
          </h4>
          
  </div>
  
  <div id="waline"></div>
  <script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';
    let option = '{"el":"#waline","enable":true,"serverURL":"https://waline-urweb.vercel.app/","placeholder":"歡迎隨時提出您的建議，並不吝指教","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":"en","visitor":true,"comment_count":true,"requiredFields":["nick","mail"],"libUrl":"https://cdnjs.cloudflare.com/ajax/libs/waline/2.14.5/waline.js","pageview":true,"reaction":true}';
    init(JSON.parse(option));
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>
  
    <input style="display:none" onload="addTotalViews()">
</main>